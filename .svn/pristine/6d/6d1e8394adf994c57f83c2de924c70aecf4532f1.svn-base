var purchase = function(){}

purchase.prototype = {
	/**
	 * 静态变量
	 * 请求地址URL
	 */
	urlItems : {         
		
		// test  queryOrderURL :"/nst-web-api/purchaseOrder/queryPurchaseOrderBySourceId"
		queryOrderURL :"/purchaseOrder/queryPurchaseOrderBySourceId"
	},
	/**
	 * 初始化
	 */
	init : function(){
	var sourceId =search("sourceId");
//      var sourceId ="132663";
	
//	alert(CONTEXT)
			
		if($.appVersion.ios){	
			this.handleIos(sourceId);
		}
		else if($.appVersion.android){
			this.handleAn(sourceId);
		}
//		 $("#aaa").html("aa "+sourceId);
		
	},
	// 安卓查询处理
	handleAn : function(param){
		//alert("param"+param)
		//$("#aaa").html("aa "+param);
		//var params = JavaH5WebInterface.enCode(JSON.stringify({"sourceId": param}));
		var params = JavaH5WebInterface.enCode("sourceId:"+param);
		this.getData(params);
	},
	// ios查询处理
	handleIos : function(param){
		var _this = this;
//		window.webkit.messageHandlers.NativeEncrypt.postMessage('{"data":'+'"{\'sourceId\':'+param+'}'+'","fun":"handleData"}');

	window.webkit.messageHandlers.NativeEncrypt.postMessage('{"data":"{\'sourceId\':\'' + param + '\'}","fun":"handleData"}');
		window["handleData"] = function(data){
			_this.getData(data);
		}
	},
	// 请求订单数据
	getData : function(param){
		var _this = this;
		$.ajax({
			url: this.urlItems.queryOrderURL,
			data : {"param" : param},
			type: "get",
			dataType: "text",
			contentType: "application/json",
			success: function(data){
				if($.appVersion.ios){
					window.webkit.messageHandlers.NativeDecrypt.postMessage('{"data":"'+data+'","fun":"decryptCompleted"}');
					window["decryptCompleted"] = function(data){
						var datasVal = JSON.stringify(data).replace(/\\| /g,"");
						datasVal = JSON.parse(datasVal.substring(1,datasVal.length-1));
						_this.render(datasVal);
					} 
				}
				else if($.appVersion.android){
					var adata = JSON.parse(JavaH5WebInterface.deCode(data));
					// alert(JSON.stringify(adata))
					_this.render(adata);
				
					
				}
				
				

				//打电话功能
				 $("body").on("tap",".info_phone", function(){
				var phone = $(this).attr("data-phone");
					if($.appVersion.ios){	
						
						window.webkit.messageHandlers.NativeMakeCall.postMessage(phone);
					}
					else if($.appVersion.android){
						JavaH5WebInterface.callMobile(phone);
					}
				});
			}/*,error:function(data){
				allert("error")
			}*/
		});
	},
	// 渲染页面
	render : function(data){
		$("#shop_weaper").html($("#shop_weaperTemp").tmpl(data.result));
		$("#goods_weaper").html($("#goods_weaperTemp").tmpl(data.result.productDetails));
		$("#car_weaper").html($("#car_weaperTemp").tmpl(data.result));
	}
};

$(function(){
	var purch = new purchase();
	purch.init();
	
});